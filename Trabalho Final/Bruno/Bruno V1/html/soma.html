<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Preview Image</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"
    integrity="sha512-cyzxRvewl+FOKTtpBzYjW6x6IAYUCZy3sGP40hn+DQkqeluGRCax7qztK2ImL64SA+C7kVWdLI6wvdlStawhyw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
  <div class="container" id="box-crop">
    <div id="preview-crop"></div>
    <div id="box">
      <h2 id="h2-avatar">Avatar</h2>
      <form enctype="multipart/form-data">
        <input type="file" name="file" id="avatar-image">
      </form>
    </div>
  </div>

  <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"
    integrity="sha512-6lplKUSl86rUVprDIjiW8DuOniNX8UDoRATqZSds/7t6zCQZfaCe3e5zcGaQwxa8Kpn5RTM9Fvl3X2lLV4grPQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>

    function crop(image){
      return new Cropper(image, {
        dragMode:'move',
        preview:'#preview-crop',
      })
    }

    const avatarImage = document.querySelector('#avatar-image');
    const h2Avatar = document.querySelector('#h2-avatar');
    let cropper;

    avatarImage.addEventListener('change', event => {
      const preview = document.querySelector('#preview-image');
      const previewImage = document.createElement('img');

      if (preview) {
        preview.remove();
      }

      const reader = new FileReader;

      reader.onload = function(event) {
        previewImage.id = 'preview-image';
        previewImage.src = event.target.result;
        h2Avatar.insertAdjacentElement('afterend', previewImage);
      }

      reader.readAsDataURL(avatarImage.files[0]);

      setTimeout(() => {
        cropper = crop(previewImage);
        let previewCrop = document.querySelector('#preview-crop');
        previewCrop.style = 'display:block';

        h2Avatar.insertAdjacentHTML('afterend', `
          <button id="remove-crop-btn">Remove Crop</button>
          <button id="upload-btn">Upload</button>
          <button id="crop-btn">Corte</button>
        `);

        const removeCropButton = document.querySelector('#remove-crop-btn');
        const uploadButton = document.querySelector('#upload-btn');
        const cropButton = document.querySelector('#crop-btn');

        removeCropButton.addEventListener('click', event => {
          cropper.destroy();
          removeCropButton.remove();
          uploadButton.remove();
          previewImage.remove();
          previewCrop.style = 'display:none';
        });

        uploadButton.addEventListener('click', () => {
          // Handle upload here
        });

        cropButton.addEventListener('click', () => {
          const cropData = cropper.getData(true);
          console.log("x:", cropData.x, "y:", cropData.y, "width:", cropData.width, "height:", cropData.height);
        });

      },200)

    })

  </script>

</body>

</html>
